<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Bar</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <div class="main-layout">
        
        <div class="left-panel-container">
        <!-- Left Panel -->
            <!--Drop Zone-->
            <div class="drop-zone" id="dropZone">
                <h3>Assets</h3>
                <div id="selectedItems">
                    <p id="placeholder" style="color: #999; font-style: italic;">Drag and drop your assets here...</p>
                </div>
            </div>
            <!--CVE Counter-->
            <div class="cveCounts-container">
                <div id="cveCounts">0 CVEs found</div>
            </div>
            <!--Search Filters-->
            <div class="filter-panel" id="searchFilterPanel" style="display: none;">
                <h3>Filters</h3>
                <div class="filter-fields">
                    <div class="filter-field">
                        <label for="filterDeprecated">Deprecated</label>
                        <select id="filterDeprecated">
                            <option value="">Any</option>
                            <option value="false">No</option>
                            <option value="true">Yes</option>
                        </select>
                    </div>
                    <div class="filter-field">
                        <label for="filterDateFrom">Created From</label>
                        <input type="date" id="filterDateFrom">
                    </div>
                    <div class="filter-field">
                        <label for="filterDateTo">Created To</label>
                        <input type="date" id="filterDateTo">
                    </div>
                    <div class="filter-field">
                        <label for="filterVendor">Vendor</label>
                        <input type="text" id="filterVendor" placeholder="e.g. microsoft">
                    </div>
                    <div class="filter-field">
                        <label for="filterProduct">Product</label>
                        <input type="text" id="filterProduct" placeholder="e.g. windows">
                    </div>
                    <div class="filter-field">
                        <label for="filterVersion">Version</label>
                        <input type="text" id="filterVersion" placeholder="e.g. 1.0">
                    </div>
                    <div class="filter-field">
                        <label for="filterUpdate">Update</label>
                        <input type="text" id="filterUpdate" placeholder="e.g. sp1">
                    </div>
                    <div class="filter-field">
                        <label for="filterEdition">Edition</label>
                        <input type="text" id="filterEdition" placeholder="e.g. enterprise">
                    </div>
                    <div class="filter-field">
                        <label for="filterLanguage">Language</label>
                        <input type="text" id="filterLanguage" placeholder="e.g. en">
                    </div>
                    <div class="filter-field">
                        <label for="filterSwEdition">SW Edition</label>
                        <input type="text" id="filterSwEdition" placeholder="e.g. pro">
                    </div>
                    <div class="filter-field">
                        <label for="filterTargetSw">Target SW</label>
                        <input type="text" id="filterTargetSw" placeholder="e.g. windows">
                    </div>
                    <div class="filter-field">
                        <label for="filterTargetHw">Target HW</label>
                        <input type="text" id="filterTargetHw" placeholder="e.g. x64">
                    </div>
                </div>
                <button id="applyFilters" class="filter-apply-btn">Apply</button>
                <a href="#" id="clearFilters" class="advanced-search-link">Clear Filters</a>
            </div>
        </div>

        <!-- Tab Container -->
        <div class="tab-container" style="display: flex; flex-direction: column;">

            <div class="tab-header">
                <button class="tab-button active" data-tab="search">Search</button>
                <button class="tab-button" data-tab="charts">Charts</button>
                <button class="tab-button" data-tab="cve">CVE Details</button>
                <button class="tab-button" data-tab="next-steps">Next Steps</button>
            </div>
            <div class="tab-content">
                <!--Search Tab-->
                <div class="tab-panel active" data-panel="search">
                    <h2>Search CPEs</h2>
                
                    <!-- Simple Search -->
                    <div id="simpleSearch">
                        <div class="search-container">
                            <input type="text" id="searchInput" placeholder="Search...">
                            <button id="searchButton">Search</button>
                        </div>
                        <a href="#" id="toggleAdvancedSearch" class="advanced-search-link">Advanced Search</a>
                    </div>
                
                    <!-- Advanced Search -->
                    <div id="advancedSearch" style="display: none;">
                        <a href="#" id="toggleSimpleSearch" class="advanced-search-link">&#8592; Go Back to Search</a>
                        <div class="advanced-search-grid">
                            <div class="adv-field">
                                <label for="advPart">Part</label>
                                <select id="advPart">
                                    <option value="" selected>Any</option>
                                    <option value="a">Application (a)</option>
                                    <option value="h">Hardware (h)</option>
                                    <option value="o">Operating System (o)</option>
                                </select>
                            </div>
                            <div class="adv-field">
                                <label for="advVendor">Vendor</label>
                                <input type="text" id="advVendor" placeholder="e.g. microsoft">
                            </div>
                            <div class="adv-field">
                                <label for="advProduct">Product</label>
                                <input type="text" id="advProduct" placeholder="e.g. windows_10">
                            </div>
                            <div class="adv-field">
                                <label for="advVersion">Version</label>
                                <input type="text" id="advVersion" placeholder="e.g. 1.0.0">
                            </div>
                            <div class="adv-field">
                                <label for="advUpdate">Update</label>
                                <input type="text" id="advUpdate" placeholder="e.g. sp1">
                            </div>
                            <div class="adv-field">
                                <label for="advEdition">Edition</label>
                                <input type="text" id="advEdition" placeholder="e.g. enterprise">
                            </div>
                            <div class="adv-field">
                                <label for="advLanguage">Language</label>
                                <input type="text" id="advLanguage" placeholder="e.g. en">
                            </div>
                            <div class="adv-field">
                                <label for="advSwEdition">Software Edition</label>
                                <input type="text" id="advSwEdition" placeholder="e.g. pro">
                            </div>
                            <div class="adv-field">
                                <label for="advTargetSw">Target Software</label>
                                <input type="text" id="advTargetSw" placeholder="e.g. windows">
                            </div>
                            <div class="adv-field">
                                <label for="advTargetHw">Target Hardware</label>
                                <input type="text" id="advTargetHw" placeholder="e.g. x64">
                            </div>
                            <div class="adv-field">
                                <label for="advOther">Other</label>
                                <input type="text" id="advOther" placeholder="Miscellaneous">
                            </div>
                        </div>
                        <div class="search-container" style="margin-top: 12px;">
                            <button id="advSearchButton">Search</button>
                        </div>
                    </div>

                    <!--Results Container-->
                    <div id="resultsContainer" style="display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <h2>Results</h2>
                            <a href="#" id="clearResults">Clear Results</a>
                        </div>
                        <div id="resultsList"></div>
                        <div id="pagination" style="display: none; margin-top: 20px; text-align: center;">
                            <button id="prevPage" disabled>Previous</button>
                            <span style="margin: 0 15px;">
                                Page <input type="text" id="pageInput" min="1" value="1" style="width: 25px; text-align: center;"> of <span id="totalPages"></span>
                            </span>
                            <button id="nextPage" disabled>Next</button>
                        </div>
                    </div>
                </div>
                <!--Charts Tab-->
                <div class="tab-panel" data-panel="charts">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <h2>Charts</h2>
                        <button id="chartFullscreenToggle" class="chart-fullscreen-btn" style="display: none;" title="Expand chart">&#x26F6;</button>
                    </div>
                    <!--Chart Configuration-->
                    <div id="chartConfig" class="chart-config">
                        <div class="config-row">
                            <label for="riskFormulaSelect">Risk Formula</label>
                            <select id="riskFormulaSelect">
                                <option value="weighted_average" selected>Weighted Average</option>
                                <option value="multiplicative">Multiplicative</option>
                                <option value="max">Max Score</option>
                                <option value="simple_mean">Simple Mean</option>
                            </select>
                        </div>
                        <div class="config-row">
                            <label for="aggMethodSelect">Aggregation Method</label>
                            <select id="aggMethodSelect">
                                <option value="max">Max</option>
                                <option value="mean" selected>Mean</option>
                                <option value="median">Median</option>
                                <option value="sum">Sum</option>
                            </select>
                        </div>
                        <div class="config-row">
                            <label for="riskThresholdSlider">Risk Threshold: <span id="thresholdValue">7.0</span></label>
                            <input type="range" id="riskThresholdSlider" min="0" max="10" step="0.5" value="7">
                        </div>
                    </div>
                    <p id="chartPlaceholder" style="color: #999; font-style: italic;">Add assets to generate charts.</p>
                    <div style="position: relative; width: 100%;">
                        <canvas id="epssChart" style="display: none;"></canvas>
                        <canvas id="ciaRadarChart" style="display: none; max-width: 500px;"></canvas>
                    </div>
                </div>
                <!--CVE Tab-->
                <div class="tab-panel" data-panel="cve">
                    <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 600px;">
                        <h2>CVE Details</h2>
                    </div>
                    <div id="cveGrid" class="cve-grid"></div>
                    <div id="cveFolderView" style="display: none;">
                        <a href="#" class="cve-folder-back" id="cveFolderBack">← Back to assets</a>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <h3 id="cveFolderTitle"></h3>
                            <span id="cpeInfoIcon" class="cpe-info-icon" title="View CPE Information">&#x1F6C8;</span>
                            <button class="folder-dl-btn" onclick="downloadCveCSV()">CSV</button>
                            <button class="folder-dl-btn" onclick="downloadCveJSON()">JSON</button>
                        </div>
                        <div class="cve-folder-scroll">
                            <table id="cveFolderTable" class="cve-detail-table">
                                <thead>
                                    <tr>
                                        <th data-sort="id">CVE ID <span class="sort-arrow"></span></th>
                                        <th data-sort="published">Published <span class="sort-arrow"></span></th>
                                        <th data-sort="kev">KEV <span class="sort-arrow"></span></th>
                                        <th data-sort="epss">EPSS <span class="sort-arrow"></span></th>
                                        <th data-sort="cwe">CWE <span class="sort-arrow"></span></th>
                                        <th data-sort="status">Status <span class="sort-arrow"></span></th>
                                        <th data-sort="tags">Tags <span class="sort-arrow"></span></th>
                                        <th data-sort="cvss">CVSS <span class="sort-arrow"></span></th>
                                        <th data-sort="severity">Severity <span class="sort-arrow"></span></th>
                                    </tr>
                                </thead>
                                <tbody id="cveFolderBody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <!--Next Steps Tab-->
                <!--Next Steps Tab-->
                <div class="tab-panel" data-panel="next-steps">
                    <h2>Next Steps</h2>
                    <div style="margin-bottom: 15px;">
                        <span id="createTicketBtn" style="cursor: pointer; color: #be7a15; font-size: 1.1em;">➕ Create New Ticket</span>
                    </div>
                    <div id="ticketFormContainer" style="display: none; max-width: 600px; border: 1px solid #ddd; border-radius: 6px; padding: 16px; background: #fafafa; margin-bottom: 20px;">
                        <h3 style="margin-top: 0;">New Remediation Ticket</h3>
                        <div style="display: flex; flex-direction: column; gap: 10px;">
                            <div>
                                <label style="font-weight: 600; font-size: 0.85em; color: #57534E;">Description</label>
                                <textarea id="ticketDescription" rows="4" style="width: 100%; padding: 8px; font-size: 14px; border: 2px solid #ddd; border-radius: 4px; resize: vertical; box-sizing: border-box;" placeholder="Describe the issue to be remediated..."></textarea>
                            </div>
                            <div>
                                <label style="font-weight: 600; font-size: 0.85em; color: #57534E;">Related Feature</label>
                                <select id="ticketFeature" style="width: 100%; padding: 8px 10px; font-size: 14px; border: 2px solid #ddd; border-radius: 4px; background: white;">
                                    <option value="" selected>— Select feature —</option>
                                    <option value="Search">Search</option>
                                    <option value="Charts">Charts</option>
                                    <option value="CVE Details">CVE Details</option>
                                    <option value="Next Steps">Next Steps</option>
                                    <option value="Left Panel">Left Panel</option>
                                    <option value="Right Panel">Right Panel</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 10px;">
                                <button id="submitTicketBtn" style="padding: 8px 20px; background-color: #be7a15; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Submit Ticket</button>
                                <button id="cancelTicketBtn" style="padding: 8px 20px; background-color: #ccc; color: #333; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">Cancel</button>
                            </div>
                        </div>
                    </div>
                    <div id="ticketsList"></div>
                </div>
            </div>
        </div>
        <!--Right Panel-->
        <div class="right-panel-container" style="display: none;">
            <button id="toggleRightPanel" class="panel-toggle-btn" style="display: none;">&#9654;</button>
            <div id="rightPanelContent">
                <!--Vulnerabilities-->
                <div id="cveContainer" style="display: none;">
                    <ul id="cveList" style="list-style: none; padding: 0;"></ul>
                </div>
                <div id="expandedViewContainer" style="display: none;">
                    <div id="expandedDetails"></div>
                </div>
            </div>
        </div>
    </div>
</body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <script src="/static/app.js"></script>
</html>